{% extends "base.html" %}

{% block title %}Sentiment Analysis - SentimentPro{% endblock %}

{% block content %}
<div class="container">
    <div class="hero-section">
        <h1 class="hero-title">Advanced Sentiment Analysis</h1>
        <p class="hero-subtitle">Analyze emotions, sentiment, and text characteristics with AI-powered precision</p>
    </div>

    <div class="analysis-section">
        <div class="input-card">
            <h2><i class="fas fa-comment-dots"></i> Enter Text to Analyze</h2>
            <textarea 
                id="textInput" 
                placeholder="Type or paste your text here (e.g., product reviews, social media posts, comments)..."
                maxlength="2000"
                rows="6"
            ></textarea>
            
            <div class="input-meta">
                <span id="charCount">0/2000 characters</span>
                <div class="input-actions">
                    <button id="clearBtn" class="btn btn-secondary">
                        <i class="fas fa-eraser"></i> Clear
                    </button>
                    <button id="analyzeBtn" class="btn btn-primary">
                        <i class="fas fa-magic"></i> Analyze Sentiment
                    </button>
                </div>
            </div>
        </div>

        <div id="loading" class="loading hidden">
            <div class="spinner"></div>
            <p>Analyzing your text with advanced AI models...</p>
        </div>

        <div id="results" class="results hidden">
            <!-- Results will be populated by JavaScript -->
        </div>

        <div id="error" class="error hidden">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="errorMessage"></span>
        </div>
    </div>

    <div class="features-section">
        <h2>What We Analyze</h2>
        <div class="features-grid">
            <div class="feature-card">
                <i class="fas fa-smile"></i>
                <h3>Sentiment Analysis</h3>
                <p>Detect positive, negative, and neutral sentiment with precision</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-heart"></i>
                <h3>Emotion Detection</h3>
                <p>Identify happiness, anger, surprise, sadness, and fear</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-chart-bar"></i>
                <h3>Text Statistics</h3>
                <p>Comprehensive analysis of word count, vocabulary, and readability</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-key"></i>
                <h3>Keyword Extraction</h3>
                <p>Identify the most important words and phrases</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Character counter
    const textInput = document.getElementById('textInput');
    const charCount = document.getElementById('charCount');
    
    textInput.addEventListener('input', () => {
        const length = textInput.value.length;
        charCount.textContent = `${length}/2000 characters`;
        
        if (length > 1900) {
            charCount.style.color = '#e74c3c';
        } else if (length > 1500) {
            charCount.style.color = '#f39c12';
        } else {
            charCount.style.color = '#7f8c8d';
        }
    });

    // Clear button
    document.getElementById('clearBtn').addEventListener('click', () => {
        textInput.value = '';
        charCount.textContent = '0/2000 characters';
        charCount.style.color = '#7f8c8d';
        document.getElementById('results').classList.add('hidden');
        document.getElementById('error').classList.add('hidden');
    });

    // Analyze button
    document.getElementById('analyzeBtn').addEventListener('click', analyzeText);
    
    textInput.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.key === 'Enter') {
            analyzeText();
        }
    });

    async function analyzeText() {
        const text = textInput.value.trim();
        if (!text) {
            showError('Please enter some text to analyze');
            return;
        }

        showLoading();
        hideError();

        try {
            const response = await fetch('/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ text: text })
            });

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.error || 'Analysis failed');
            }

            displayResults(data);
        } catch (error) {
            showError(error.message);
        } finally {
            hideLoading();
        }
    }

    function showLoading() {
        document.getElementById('loading').classList.remove('hidden');
        document.getElementById('results').classList.add('hidden');
    }

    function hideLoading() {
        document.getElementById('loading').classList.add('hidden');
    }

    function showError(message) {
        const errorDiv = document.getElementById('error');
        document.getElementById('errorMessage').textContent = message;
        errorDiv.classList.remove('hidden');
    }

    function hideError() {
        document.getElementById('error').classList.add('hidden');
    }

    function displayResults(data) {
        // This will be implemented in the main.js file
        window.displayAnalysisResults(data);
        document.getElementById('results').classList.remove('hidden');
    }
</script>
{% endblock %}